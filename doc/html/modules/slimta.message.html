<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>slimta.message: Module Index</title>
    <link rel="stylesheet" href="../luadoc.css" type="text/css" />
    <!--meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/-->
</head>

<body>
<div id="container">

<div id="product">
    <div id="product_logo"></div>
    <div id="product_name"><big><b></b></big></div>
    <div id="product_description"></div>
</div> <!-- id="product" -->

<div id="main">

<div id="navigation">


<h1>LuaDoc</h1>
<ul>
	
	<li><a href="../index.html">Index</a></li>
	
</ul>


<!-- Module list -->

<h1>Modules</h1>
<ul>

	<li>
		<a href="../modules/slimta.html">slimta</a>
	</li>

	<li>
		<a href="../modules/slimta.base64.html">slimta.base64</a>
	</li>

	<li>
		<a href="../modules/slimta.bus.html">slimta.bus</a>
	</li>

	<li>
		<a href="../modules/slimta.bus.proxy.html">slimta.bus.proxy</a>
	</li>

	<li>
		<a href="../modules/slimta.edge.http.html">slimta.edge.http</a>
	</li>

	<li>
		<a href="../modules/slimta.edge.smtp.html">slimta.edge.smtp</a>
	</li>

	<li>
		<a href="../modules/slimta.edge.smtp.auth.html">slimta.edge.smtp.auth</a>
	</li>

	<li>
		<a href="../modules/slimta.hmac.html">slimta.hmac</a>
	</li>

	<li><strong>slimta.message</strong></li>
	
	<li>
		<a href="../modules/slimta.message.bounce.html">slimta.message.bounce</a>
	</li>

	<li>
		<a href="../modules/slimta.message.client.html">slimta.message.client</a>
	</li>

	<li>
		<a href="../modules/slimta.message.contents.html">slimta.message.contents</a>
	</li>

	<li>
		<a href="../modules/slimta.message.envelope.html">slimta.message.envelope</a>
	</li>

	<li>
		<a href="../modules/slimta.message.response.html">slimta.message.response</a>
	</li>

	<li>
		<a href="../modules/slimta.policies.add_date_header.html">slimta.policies.add_date_header</a>
	</li>

	<li>
		<a href="../modules/slimta.policies.add_message_id_header.html">slimta.policies.add_message_id_header</a>
	</li>

	<li>
		<a href="../modules/slimta.policies.add_received_header.html">slimta.policies.add_received_header</a>
	</li>

	<li>
		<a href="../modules/slimta.policies.forward.html">slimta.policies.forward</a>
	</li>

	<li>
		<a href="../modules/slimta.queue.html">slimta.queue</a>
	</li>

	<li>
		<a href="../modules/slimta.relay.html">slimta.relay</a>
	</li>

	<li>
		<a href="../modules/slimta.relay.maildrop.html">slimta.relay.maildrop</a>
	</li>

	<li>
		<a href="../modules/slimta.relay.smtp.html">slimta.relay.smtp</a>
	</li>

	<li>
		<a href="../modules/slimta.routing.mx.html">slimta.routing.mx</a>
	</li>

	<li>
		<a href="../modules/slimta.routing.static.html">slimta.routing.static</a>
	</li>

	<li>
		<a href="../modules/slimta.signalfd.html">slimta.signalfd</a>
	</li>

	<li>
		<a href="../modules/slimta.storage.html">slimta.storage</a>
	</li>

	<li>
		<a href="../modules/slimta.storage.session.html">slimta.storage.session</a>
	</li>

	<li>
		<a href="../modules/slimta.uuid.html">slimta.uuid</a>
	</li>

	<li>
		<a href="../modules/slimta.xml.html">slimta.xml</a>
	</li>

	<li>
		<a href="../modules/slimta.xml.reader.html">slimta.xml.reader</a>
	</li>

	<li>
		<a href="../modules/slimta.xml.writer.html">slimta.xml.writer</a>
	</li>

</ul>



<!-- File list -->






</div><!-- id="navigation" -->

<div id="content">

<h1>Module <code>slimta.message</code></h1>

<p>Module for representing email message and all their associated data. This module implements the routines for storing and retrieving messages from a storage engine and serializing messages into transmittable form.</p>





<h2>Functions</h2>
<table class="function_list">

    <tr>
    <td class="name" nowrap><a href="#slimta.message.copy">slimta.message.copy</a>&nbsp;(old)</td>
    <td class="summary">Copies the contents and information of an old message into a new one.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.message.from_meta">slimta.message.from_meta</a>&nbsp;(meta, raw_contents, force_id)</td>
    <td class="summary">Loads a message object from the given simple table of meta information and raw message contents.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.message.from_xml">slimta.message.from_xml</a>&nbsp;(tree_node, attachments, force_id)</td>
    <td class="summary">Loads a message object from the given XML node tree, as generated by the slimta.xml.reader module.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.message.increment_attempts">slimta.message.increment_attempts</a>&nbsp;(self, storage_session)</td>
    <td class="summary">Increments self.attempts and updates the corresponding key for the message in storage.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.message.load">slimta.message.load</a>&nbsp;(storage_session, id)</td>
    <td class="summary">Loads the message from storage using a pre-connected storage session.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.message.new">slimta.message.new</a>&nbsp;(client, envelope, contents, timestamp, id, attempts)</td>
    <td class="summary">Creates a new message object described by the given information.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.message.store">slimta.message.store</a>&nbsp;(self, storage_session, id)</td>
    <td class="summary">Stores the message into storage using a pre-connected storage session.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.message.to_meta">slimta.message.to_meta</a>&nbsp;(message, meta)</td>
    <td class="summary">Creates a simple key-value table describing all the information contained in the message object, suitable for serialization or, more commonly, storage in a storage engine.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.message.to_xml">slimta.message.to_xml</a>&nbsp;(self, attachments)</td>
    <td class="summary">Generates a table array of lines of XML representing the message object.</td>
    </tr>

</table>






<br/>
<br/>



<h2><a name="functions"></a>Functions</h2>
<dl class="function">



<dt><a name="slimta.message.copy"></a><strong>slimta.message.copy</strong>&nbsp;(old)</dt>
<dd>
Copies the contents and information of an old message into a new one. This is a "deep" copy operation, tables are not recycled.


<h3>Parameters</h3>
<ul>
	
	<li>
	  old: message object to copy.
	</li>
	
</ul>






<h3>Return value:</h3>
a new message object identical to the original.



</dd>




<dt><a name="slimta.message.from_meta"></a><strong>slimta.message.from_meta</strong>&nbsp;(meta, raw_contents, force_id)</dt>
<dd>
Loads a message object from the given simple table of meta information and raw message contents.


<h3>Parameters</h3>
<ul>
	
	<li>
	  meta: simple table of meta information to load from.
	</li>
	
	<li>
	  raw_contents: raw message contents.
	</li>
	
	<li>
	  force_id: if given, will be set as the message's storage ID, potentially overriding any value loaded from the table.
	</li>
	
</ul>






<h3>Return value:</h3>
a new message object.



</dd>




<dt><a name="slimta.message.from_xml"></a><strong>slimta.message.from_xml</strong>&nbsp;(tree_node, attachments, force_id)</dt>
<dd>
Loads a message object from the given XML node tree, as generated by the slimta.xml.reader module. Message contents are read from the attachments table.


<h3>Parameters</h3>
<ul>
	
	<li>
	  tree_node: node of the XML tree where the message starts.
	</li>
	
	<li>
	  attachments: table of attachments containing message contents.
	</li>
	
	<li>
	  force_id: if given, will be set as the message's storage ID, potentially overriding any value stored in the XML.
	</li>
	
</ul>






<h3>Return value:</h3>
a new message object.



<h3>See also:</h3>
<ul>
	
	<li><a href="../modules/slimta.xml.reader.html">
		slimta.xml.reader
	</a>
	
</ul>

</dd>




<dt><a name="slimta.message.increment_attempts"></a><strong>slimta.message.increment_attempts</strong>&nbsp;(self, storage_session)</dt>
<dd>
Increments self.attempts and updates the corresponding key for the message in storage. The message must already be in storage.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the message object, already in storage.
	</li>
	
	<li>
	  storage_session: pre-connected storage session object.
	</li>
	
</ul>








<h3>See also:</h3>
<ul>
	
	<li><a href="../modules/slimta.storage.html">
		slimta.storage
	</a>
	
</ul>

</dd>




<dt><a name="slimta.message.load"></a><strong>slimta.message.load</strong>&nbsp;(storage_session, id)</dt>
<dd>
Loads the message from storage using a pre-connected storage session. After loading, message.id is set to the given id if successful.


<h3>Parameters</h3>
<ul>
	
	<li>
	  storage_session: pre-connected storage session object.
	</li>
	
	<li>
	  id: message ID string to load from storage.
	</li>
	
</ul>






<h3>Return value:</h3>
new message object if successful, or nil followed by an error message. Error message will be "invalid" if the query did not error but did not match any message IDs.



<h3>See also:</h3>
<ul>
	
	<li><a href="../modules/slimta.storage.html">
		slimta.storage
	</a>
	
</ul>

</dd>




<dt><a name="slimta.message.new"></a><strong>slimta.message.new</strong>&nbsp;(client, envelope, contents, timestamp, id, attempts)</dt>
<dd>
Creates a new message object described by the given information.


<h3>Parameters</h3>
<ul>
	
	<li>
	  client: message.client object containing client info.
	</li>
	
	<li>
	  envelope: message.envelope object containing envelope info.
	</li>
	
	<li>
	  contents: message.contents object containing message contents.
	</li>
	
	<li>
	  timestamp: UNIX timestamp of original message reception.
	</li>
	
	<li>
	  id: storage ID of a message, if available.
	</li>
	
	<li>
	  attempts: number of delivery attempts the message has undergone.
	</li>
	
</ul>






<h3>Return value:</h3>
a new message object.



<h3>See also:</h3>
<ul>
	
	<li><a href="../modules/slimta.message.client.html">
		slimta.message.client
	</a>
	
	<li><a href="../modules/slimta.message.envelope.html">
		slimta.message.envelope
	</a>
	
	<li><a href="../modules/slimta.message.contents.html">
		slimta.message.contents
	</a>
	
</ul>

</dd>




<dt><a name="slimta.message.store"></a><strong>slimta.message.store</strong>&nbsp;(self, storage_session, id)</dt>
<dd>
Stores the message into storage using a pre-connected storage session. If an existing ID is not given, this message will generate a new, unclaimed UUID which will be set as self.id.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the message object.
	</li>
	
	<li>
	  storage_session: pre-connected storage session object.
	</li>
	
	<li>
	  id: optional existing message ID, for updating an existing stored message.
	</li>
	
</ul>






<h3>Return value:</h3>
the message ID where the message was stored.



<h3>See also:</h3>
<ul>
	
	<li><a href="../modules/slimta.storage.html">
		slimta.storage
	</a>
	
</ul>

</dd>




<dt><a name="slimta.message.to_meta"></a><strong>slimta.message.to_meta</strong>&nbsp;(message, meta)</dt>
<dd>
Creates a simple key-value table describing all the information contained in the message object, suitable for serialization or, more commonly, storage in a storage engine.


<h3>Parameters</h3>
<ul>
	
	<li>
	  message: the message object.
	</li>
	
	<li>
	  meta: if given, keys are added to this table rather than a new one.
	</li>
	
</ul>






<h3>Return value:</h3>
the simple table of meta information.



</dd>




<dt><a name="slimta.message.to_xml"></a><strong>slimta.message.to_xml</strong>&nbsp;(self, attachments)</dt>
<dd>
Generates a table array of lines of XML representing the message object. For the message contents, instead of serializing into XML, they are appended to the given table of attachments so they can be sent separately in raw form.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the message object.
	</li>
	
	<li>
	  attachments: table of attachments for message contents.
	</li>
	
</ul>






<h3>Return value:</h3>
a table array of XML lines.



<h3>See also:</h3>
<ul>
	
	<li><a href="../modules/slimta.xml.writer.html">
		slimta.xml.writer
	</a>
	
</ul>

</dd>


</dl>






</div> <!-- id="content" -->

</div> <!-- id="main" -->

<div id="about">
    <p><a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0!" height="31" width="88" /></a></p>
</div> <!-- id="about" -->

</div> <!-- id="container" -->
</body>
</html>
