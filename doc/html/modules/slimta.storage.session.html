<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>slimta.storage.session: Module Index</title>
    <link rel="stylesheet" href="../luadoc.css" type="text/css" />
    <!--meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/-->
</head>

<body>
<div id="container">

<div id="product">
    <div id="product_logo"></div>
    <div id="product_name"><big><b></b></big></div>
    <div id="product_description"></div>
</div> <!-- id="product" -->

<div id="main">

<div id="navigation">


<h1>LuaDoc</h1>
<ul>
	
	<li><a href="../index.html">Index</a></li>
	
</ul>


<!-- Module list -->

<h1>Modules</h1>
<ul>

	<li>
		<a href="../modules/slimta.html">slimta</a>
	</li>

	<li>
		<a href="../modules/slimta.base64.html">slimta.base64</a>
	</li>

	<li>
		<a href="../modules/slimta.bus.html">slimta.bus</a>
	</li>

	<li>
		<a href="../modules/slimta.bus.proxy.html">slimta.bus.proxy</a>
	</li>

	<li>
		<a href="../modules/slimta.edge.http.html">slimta.edge.http</a>
	</li>

	<li>
		<a href="../modules/slimta.edge.smtp.html">slimta.edge.smtp</a>
	</li>

	<li>
		<a href="../modules/slimta.edge.smtp.auth.html">slimta.edge.smtp.auth</a>
	</li>

	<li>
		<a href="../modules/slimta.hmac.html">slimta.hmac</a>
	</li>

	<li>
		<a href="../modules/slimta.message.html">slimta.message</a>
	</li>

	<li>
		<a href="../modules/slimta.message.bounce.html">slimta.message.bounce</a>
	</li>

	<li>
		<a href="../modules/slimta.message.client.html">slimta.message.client</a>
	</li>

	<li>
		<a href="../modules/slimta.message.contents.html">slimta.message.contents</a>
	</li>

	<li>
		<a href="../modules/slimta.message.envelope.html">slimta.message.envelope</a>
	</li>

	<li>
		<a href="../modules/slimta.message.response.html">slimta.message.response</a>
	</li>

	<li>
		<a href="../modules/slimta.policies.add_date_header.html">slimta.policies.add_date_header</a>
	</li>

	<li>
		<a href="../modules/slimta.policies.add_message_id_header.html">slimta.policies.add_message_id_header</a>
	</li>

	<li>
		<a href="../modules/slimta.policies.add_received_header.html">slimta.policies.add_received_header</a>
	</li>

	<li>
		<a href="../modules/slimta.policies.forward.html">slimta.policies.forward</a>
	</li>

	<li>
		<a href="../modules/slimta.queue.html">slimta.queue</a>
	</li>

	<li>
		<a href="../modules/slimta.relay.html">slimta.relay</a>
	</li>

	<li>
		<a href="../modules/slimta.relay.maildrop.html">slimta.relay.maildrop</a>
	</li>

	<li>
		<a href="../modules/slimta.relay.smtp.html">slimta.relay.smtp</a>
	</li>

	<li>
		<a href="../modules/slimta.routing.mx.html">slimta.routing.mx</a>
	</li>

	<li>
		<a href="../modules/slimta.routing.static.html">slimta.routing.static</a>
	</li>

	<li>
		<a href="../modules/slimta.signalfd.html">slimta.signalfd</a>
	</li>

	<li>
		<a href="../modules/slimta.storage.html">slimta.storage</a>
	</li>

	<li><strong>slimta.storage.session</strong></li>
	
	<li>
		<a href="../modules/slimta.uuid.html">slimta.uuid</a>
	</li>

	<li>
		<a href="../modules/slimta.xml.html">slimta.xml</a>
	</li>

	<li>
		<a href="../modules/slimta.xml.reader.html">slimta.xml.reader</a>
	</li>

	<li>
		<a href="../modules/slimta.xml.writer.html">slimta.xml.writer</a>
	</li>

</ul>



<!-- File list -->






</div><!-- id="navigation" -->

<div id="content">

<h1>Module <code>slimta.storage.session</code></h1>

<p>Module describing the methods exposed by storage engine sessions. These objects can only be created by calling the <code>connect()</code> method of a storage engine, they have no constructors. You should always call a session's <code>close()</code> method when you are done with it.</p>





<h2>Functions</h2>
<table class="function_list">

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.claim_message_id">slimta.storage.session.claim_message_id</a>&nbsp;(self)</td>
    <td class="summary">Randomly generates a new message ID and checks if it is available in the storage engine.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.close">slimta.storage.session.close</a>&nbsp;(self)</td>
    <td class="summary">Closes the given session.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.delete_message">slimta.storage.session.delete_message</a>&nbsp;(self, id)</td>
    <td class="summary">Removes all references to the message in the storage engine.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.get_active_messages">slimta.storage.session.get_active_messages</a>&nbsp;(self)</td>
    <td class="summary">Returns a table of message IDs that are currently being delivered by a relayer service.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.get_all_messages">slimta.storage.session.get_all_messages</a>&nbsp;(self)</td>
    <td class="summary">Returns a table of all message IDs stored in the engine, in any state.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.get_deferred_messages">slimta.storage.session.get_deferred_messages</a>&nbsp;(self)</td>
    <td class="summary">Returns a table of message IDs that are currently awaiting their next retry attempt.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.get_message_contents">slimta.storage.session.get_message_contents</a>&nbsp;(self, id)</td>
    <td class="summary">Loads the message contents from storage.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.get_message_meta">slimta.storage.session.get_message_meta</a>&nbsp;(self, id)</td>
    <td class="summary">Returns the stored simple meta information table.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.get_message_meta_key">slimta.storage.session.get_message_meta_key</a>&nbsp;(self, id, key)</td>
    <td class="summary">Returns the value of one stored meta key.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.lock_message">slimta.storage.session.lock_message</a>&nbsp;(self, id, length)</td>
    <td class="summary">Locks a message for a period of time.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.set_message_contents">slimta.storage.session.set_message_contents</a>&nbsp;(self, id, contents)</td>
    <td class="summary">Sets the message contents.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.set_message_meta">slimta.storage.session.set_message_meta</a>&nbsp;(self, id, meta)</td>
    <td class="summary">Sets the message meta information to the contents of the given simple meta table.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.set_message_meta_key">slimta.storage.session.set_message_meta_key</a>&nbsp;(self, id, key, value)</td>
    <td class="summary">Sets one key in the message meta information to the given value.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.set_message_retry">slimta.storage.session.set_message_retry</a>&nbsp;(self, id, timestamp)</td>
    <td class="summary">Sets the next retry attempt time for the given message.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.storage.session.unlock_message">slimta.storage.session.unlock_message</a>&nbsp;(self, id)</td>
    <td class="summary">Unlocks the message, so that the next future attempt (by any thread, process, or system) to lock the message will be successful.</td>
    </tr>

</table>






<br/>
<br/>



<h2><a name="functions"></a>Functions</h2>
<dl class="function">



<dt><a name="slimta.storage.session.claim_message_id"></a><strong>slimta.storage.session.claim_message_id</strong>&nbsp;(self)</dt>
<dd>
Randomly generates a new message ID and checks if it is available in the storage engine. If so, it is returned, if not it tries again with new random IDs until one is available. The returned message ID should be considered a stored message, even if no meta information or contents have been written yet.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
</ul>






<h3>Return value:</h3>
a new, claimed message ID.



</dd>




<dt><a name="slimta.storage.session.close"></a><strong>slimta.storage.session.close</strong>&nbsp;(self)</dt>
<dd>
Closes the given session. For example, if the storage engine required a socket connection to a remote instance, this socket would be closed.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
</ul>








</dd>




<dt><a name="slimta.storage.session.delete_message"></a><strong>slimta.storage.session.delete_message</strong>&nbsp;(self, id)</dt>
<dd>
Removes all references to the message in the storage engine. This is useful when the message was successfully delivered or when a message was permanently failed and a bounce message was queued to the sender.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
	<li>
	  id: the message ID to delete.
	</li>
	
</ul>








</dd>




<dt><a name="slimta.storage.session.get_active_messages"></a><strong>slimta.storage.session.get_active_messages</strong>&nbsp;(self)</dt>
<dd>
Returns a table of message IDs that are currently being delivered by a relayer service. These messages should be considered "locked" until the delivery attempt is completed.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
</ul>






<h3>Return value:</h3>
table of active message IDs.



</dd>




<dt><a name="slimta.storage.session.get_all_messages"></a><strong>slimta.storage.session.get_all_messages</strong>&nbsp;(self)</dt>
<dd>
Returns a table of all message IDs stored in the engine, in any state.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
</ul>






<h3>Return value:</h3>
table of message IDs.



</dd>




<dt><a name="slimta.storage.session.get_deferred_messages"></a><strong>slimta.storage.session.get_deferred_messages</strong>&nbsp;(self)</dt>
<dd>
Returns a table of message IDs that are currently awaiting their next retry attempt.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
</ul>






<h3>Return value:</h3>
table of deferred message IDs.



</dd>




<dt><a name="slimta.storage.session.get_message_contents"></a><strong>slimta.storage.session.get_message_contents</strong>&nbsp;(self, id)</dt>
<dd>
Loads the message contents from storage.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
	<li>
	  id: the message ID to load contents for.
	</li>
	
</ul>






<h3>Return value:</h3>
the raw message contents string.



<h3>See also:</h3>
<ul>
	
	<li><a href="../modules/slimta.message.contents.html">
		slimta.message.contents
	</a>
	
</ul>

</dd>




<dt><a name="slimta.storage.session.get_message_meta"></a><strong>slimta.storage.session.get_message_meta</strong>&nbsp;(self, id)</dt>
<dd>
Returns the stored simple meta information table.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
	<li>
	  id: the message ID to load meta for.
	</li>
	
</ul>






<h3>Return value:</h3>
the meta information table.



<h3>See also:</h3>
<ul>
	
	<li><a href="">
		slimta.message.from_meta
	</a>
	
</ul>

</dd>




<dt><a name="slimta.storage.session.get_message_meta_key"></a><strong>slimta.storage.session.get_message_meta_key</strong>&nbsp;(self, id, key)</dt>
<dd>
Returns the value of one stored meta key.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
	<li>
	  id: the message ID to load meta for.
	</li>
	
	<li>
	  key: the meta key to load.
	</li>
	
</ul>






<h3>Return value:</h3>
the value of the meta key.



</dd>




<dt><a name="slimta.storage.session.lock_message"></a><strong>slimta.storage.session.lock_message</strong>&nbsp;(self, id, length)</dt>
<dd>
Locks a message for a period of time. This function does not necessarily prevent other access/modification of the message, but MUST guarantee that other attempts (by other threads, processes, or systems) to lock the message will fail for the duration. This function signifies the message is active, and no other relayer may attempt delivery.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
	<li>
	  id: the message ID to lock.
	</li>
	
	<li>
	  length: the number of seconds to secure the lock.
	</li>
	
</ul>






<h3>Return value:</h3>
true if the lock was successful, false if the lock could not be established right now.



</dd>




<dt><a name="slimta.storage.session.set_message_contents"></a><strong>slimta.storage.session.set_message_contents</strong>&nbsp;(self, id, contents)</dt>
<dd>
Sets the message contents. Usually this should only ever happen once for a message.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
	<li>
	  id: the message ID to set contents for.
	</li>
	
	<li>
	  contents: the message contents object.
	</li>
	
</ul>








<h3>See also:</h3>
<ul>
	
	<li><a href="../modules/slimta.message.contents.html">
		slimta.message.contents
	</a>
	
</ul>

</dd>




<dt><a name="slimta.storage.session.set_message_meta"></a><strong>slimta.storage.session.set_message_meta</strong>&nbsp;(self, id, meta)</dt>
<dd>
Sets the message meta information to the contents of the given simple meta table.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
	<li>
	  id: the message ID to set meta for.
	</li>
	
	<li>
	  meta: the simple meta key-value table to store.
	</li>
	
</ul>








<h3>See also:</h3>
<ul>
	
	<li><a href="">
		slimta.message.to_meta
	</a>
	
</ul>

</dd>




<dt><a name="slimta.storage.session.set_message_meta_key"></a><strong>slimta.storage.session.set_message_meta_key</strong>&nbsp;(self, id, key, value)</dt>
<dd>
Sets one key in the message meta information to the given value. This is especially useful for keys that change frequently, like the number of message delivery attempts.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
	<li>
	  id: the message ID to set meta for.
	</li>
	
	<li>
	  key: the meta key to set.
	</li>
	
	<li>
	  value: the new value for the meta key.
	</li>
	
</ul>








</dd>




<dt><a name="slimta.storage.session.set_message_retry"></a><strong>slimta.storage.session.set_message_retry</strong>&nbsp;(self, id, timestamp)</dt>
<dd>
Sets the next retry attempt time for the given message. This function also signifies the message is deferred.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
	<li>
	  id: the message ID to set retry attempt timestamp for.
	</li>
	
	<li>
	  timestamp: retry delivery attempt no earlier than this timestamp.
	</li>
	
</ul>








</dd>




<dt><a name="slimta.storage.session.unlock_message"></a><strong>slimta.storage.session.unlock_message</strong>&nbsp;(self, id)</dt>
<dd>
Unlocks the message, so that the next future attempt (by any thread, process, or system) to lock the message will be successful.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the storage session object.
	</li>
	
	<li>
	  id: the message ID to unlock.
	</li>
	
</ul>








</dd>


</dl>






</div> <!-- id="content" -->

</div> <!-- id="main" -->

<div id="about">
    <p><a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0!" height="31" width="88" /></a></p>
</div> <!-- id="about" -->

</div> <!-- id="container" -->
</body>
</html>
