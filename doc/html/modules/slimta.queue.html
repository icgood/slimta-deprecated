<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>slimta.queue: Module Index</title>
    <link rel="stylesheet" href="../luadoc.css" type="text/css" />
    <!--meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/-->
</head>

<body>
<div id="container">

<div id="product">
    <div id="product_logo"></div>
    <div id="product_name"><big><b></b></big></div>
    <div id="product_description"></div>
</div> <!-- id="product" -->

<div id="main">

<div id="navigation">


<h1>LuaDoc</h1>
<ul>
	
	<li><a href="../index.html">Index</a></li>
	
</ul>


<!-- Module list -->

<h1>Modules</h1>
<ul>

	<li>
		<a href="../modules/slimta.html">slimta</a>
	</li>

	<li>
		<a href="../modules/slimta.base64.html">slimta.base64</a>
	</li>

	<li>
		<a href="../modules/slimta.bus.html">slimta.bus</a>
	</li>

	<li>
		<a href="../modules/slimta.bus.proxy.html">slimta.bus.proxy</a>
	</li>

	<li>
		<a href="../modules/slimta.edge.http.html">slimta.edge.http</a>
	</li>

	<li>
		<a href="../modules/slimta.edge.smtp.html">slimta.edge.smtp</a>
	</li>

	<li>
		<a href="../modules/slimta.edge.smtp.auth.html">slimta.edge.smtp.auth</a>
	</li>

	<li>
		<a href="../modules/slimta.hmac.html">slimta.hmac</a>
	</li>

	<li>
		<a href="../modules/slimta.message.html">slimta.message</a>
	</li>

	<li>
		<a href="../modules/slimta.message.bounce.html">slimta.message.bounce</a>
	</li>

	<li>
		<a href="../modules/slimta.message.client.html">slimta.message.client</a>
	</li>

	<li>
		<a href="../modules/slimta.message.contents.html">slimta.message.contents</a>
	</li>

	<li>
		<a href="../modules/slimta.message.envelope.html">slimta.message.envelope</a>
	</li>

	<li>
		<a href="../modules/slimta.message.response.html">slimta.message.response</a>
	</li>

	<li>
		<a href="../modules/slimta.policies.add_date_header.html">slimta.policies.add_date_header</a>
	</li>

	<li>
		<a href="../modules/slimta.policies.add_message_id_header.html">slimta.policies.add_message_id_header</a>
	</li>

	<li>
		<a href="../modules/slimta.policies.add_received_header.html">slimta.policies.add_received_header</a>
	</li>

	<li>
		<a href="../modules/slimta.policies.forward.html">slimta.policies.forward</a>
	</li>

	<li><strong>slimta.queue</strong></li>
	
	<li>
		<a href="../modules/slimta.relay.html">slimta.relay</a>
	</li>

	<li>
		<a href="../modules/slimta.relay.maildrop.html">slimta.relay.maildrop</a>
	</li>

	<li>
		<a href="../modules/slimta.relay.smtp.html">slimta.relay.smtp</a>
	</li>

	<li>
		<a href="../modules/slimta.routing.mx.html">slimta.routing.mx</a>
	</li>

	<li>
		<a href="../modules/slimta.routing.static.html">slimta.routing.static</a>
	</li>

	<li>
		<a href="../modules/slimta.signalfd.html">slimta.signalfd</a>
	</li>

	<li>
		<a href="../modules/slimta.storage.html">slimta.storage</a>
	</li>

	<li>
		<a href="../modules/slimta.storage.session.html">slimta.storage.session</a>
	</li>

	<li>
		<a href="../modules/slimta.uuid.html">slimta.uuid</a>
	</li>

	<li>
		<a href="../modules/slimta.xml.html">slimta.xml</a>
	</li>

	<li>
		<a href="../modules/slimta.xml.reader.html">slimta.xml.reader</a>
	</li>

	<li>
		<a href="../modules/slimta.xml.writer.html">slimta.xml.writer</a>
	</li>

</ul>



<!-- File list -->






</div><!-- id="navigation" -->

<div id="content">

<h1>Module <code>slimta.queue</code></h1>

<p>Module to manage the queue of messages passing through the MTA. This involves receiving messages from the edge service, storing it in a storage engine, immediately attempting relay, and retrying failed messages at regular intervals.</p>





<h2>Functions</h2>
<table class="function_list">

    <tr>
    <td class="name" nowrap><a href="#slimta.queue.accept">slimta.queue.accept</a>&nbsp;(self)</td>
    <td class="summary">Waits for a request from the edge bus.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.queue.get_all_messages">slimta.queue.get_all_messages</a>&nbsp;(self, storage_session)</td>
    <td class="summary">Returns all messages in the storage engine.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.queue.get_deferred_messages">slimta.queue.get_deferred_messages</a>&nbsp;(self, storage_session, timestamp)</td>
    <td class="summary">Gets deferred messages.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.queue.new">slimta.queue.new</a>&nbsp;(edge_bus, relay_bus, storage)</td>
    <td class="summary">Creates a new queue object.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.queue.retry">slimta.queue.retry</a>&nbsp;(self)</td>
    <td class="summary">Checks the queue for any deferred messages that are due for another attempt.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.queue.set_bounce_builder">slimta.queue.set_bounce_builder</a>&nbsp;(self, new)</td>
    <td class="summary">Sets a new bounce builder for the queue.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.queue.set_lock_duration">slimta.queue.set_lock_duration</a>&nbsp;(self, new)</td>
    <td class="summary">Sets the new lock duration in seconds.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.queue.set_retry_algorithm">slimta.queue.set_retry_algorithm</a>&nbsp;(self, func)</td>
    <td class="summary">Sets a new function to generate a retry timestamp for a failed message.</td>
    </tr>

    <tr>
    <td class="name" nowrap><a href="#slimta.queue.try_relay">slimta.queue.try_relay</a>&nbsp;(self, message, storage_session)</td>
    <td class="summary">Attempts delivery of the message.</td>
    </tr>

</table>






<br/>
<br/>



<h2><a name="functions"></a>Functions</h2>
<dl class="function">



<dt><a name="slimta.queue.accept"></a><strong>slimta.queue.accept</strong>&nbsp;(self)</dt>
<dd>
Waits for a request from the edge bus.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the queue object.
	</li>
	
</ul>






<h3>Return value:</h3>
a callable object which stores the message and attempts delivery. Usually, this is called in its own thread so that accept() may be immediately called again.



</dd>




<dt><a name="slimta.queue.get_all_messages"></a><strong>slimta.queue.get_all_messages</strong>&nbsp;(self, storage_session)</dt>
<dd>
Returns all messages in the storage engine.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the queue object.
	</li>
	
	<li>
	  storage_session: use this storage engine to get messages.
	</li>
	
</ul>






<h3>Return value:</h3>
table array of stored message objects.



</dd>




<dt><a name="slimta.queue.get_deferred_messages"></a><strong>slimta.queue.get_deferred_messages</strong>&nbsp;(self, storage_session, timestamp)</dt>
<dd>
Gets deferred messages. If timestamp is given, only messages with retry timestamps it will be returned.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the queue object.
	</li>
	
	<li>
	  storage_session: use this storage session to query deferred messages.
	</li>
	
	<li>
	  timestamp: if given, only return messages whose retry time comes before it.
	</li>
	
</ul>






<h3>Return value:</h3>
table array of deferred messages objects.



</dd>




<dt><a name="slimta.queue.new"></a><strong>slimta.queue.new</strong>&nbsp;(edge_bus, relay_bus, storage)</dt>
<dd>
Creates a new queue object. Requests are received from the edge bus, delivered to the relay bus, and messages are stored in the storage engine until they are successfully delivered or bounced.


<h3>Parameters</h3>
<ul>
	
	<li>
	  edge_bus: receive requests from the edge service on this bus.
	</li>
	
	<li>
	  relay_bus: send requests to the relay service on this bus.
	</li>
	
	<li>
	  storage: the storage engine to write to.
	</li>
	
</ul>






<h3>Return value:</h3>
a new queue object.



<h3>See also:</h3>
<ul>
	
	<li><a href="../modules/slimta.storage.html">
		slimta.storage
	</a>
	
</ul>

</dd>




<dt><a name="slimta.queue.retry"></a><strong>slimta.queue.retry</strong>&nbsp;(self)</dt>
<dd>
Checks the queue for any deferred messages that are due for another attempt. Unlike accept(), this method does not wait, but immediately returns nil if no deferred messages are ready for retry. It is expected that the caller will wait before checking again.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the queue object.
	</li>
	
</ul>






<h3>Return value:</h3>
a callable object which attempts a delivery retry for all messages that are ready. Usually, this is called in its own thread.



</dd>




<dt><a name="slimta.queue.set_bounce_builder"></a><strong>slimta.queue.set_bounce_builder</strong>&nbsp;(self, new)</dt>
<dd>
Sets a new bounce builder for the queue. This object should have a "build" method that takes a message, response, and timestamp and returns a new message object for the bounce.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the queue object.
	</li>
	
	<li>
	  new: the new bounce builder object.
	</li>
	
</ul>








<h3>See also:</h3>
<ul>
	
	<li><a href="../modules/slimta.message.bounce.html">
		slimta.message.bounce
	</a>
	
</ul>

</dd>




<dt><a name="slimta.queue.set_lock_duration"></a><strong>slimta.queue.set_lock_duration</strong>&nbsp;(self, new)</dt>
<dd>
Sets the new lock duration in seconds. Until this time expires or the lock is removed, no other queue manager will be able to lock the message and attempt a simultaneous delivery. Ideally, relayers should be configured to timeout and fail before this lock expires.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the queue object.
	</li>
	
	<li>
	  new: the new lock duration in seconds.
	</li>
	
</ul>








</dd>




<dt><a name="slimta.queue.set_retry_algorithm"></a><strong>slimta.queue.set_retry_algorithm</strong>&nbsp;(self, func)</dt>
<dd>
Sets a new function to generate a retry timestamp for a failed message. This function is passed a message object and a response object and returns nil or a timestamp number. If nil is returned, it signifies the message should not be retried and a bounce is delivered to the sender.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the queue object.
	</li>
	
	<li>
	  func: new retry algorithm function.
	</li>
	
</ul>








</dd>




<dt><a name="slimta.queue.try_relay"></a><strong>slimta.queue.try_relay</strong>&nbsp;(self, message, storage_session)</dt>
<dd>
Attempts delivery of the message.


<h3>Parameters</h3>
<ul>
	
	<li>
	  self: the queue object.
	</li>
	
	<li>
	  message: message object to deliver.
	</li>
	
	<li>
	  storage_session: if given, only attempt delivery if the message can be locked by the storage session.
	</li>
	
</ul>






<h3>Return value:</h3>
message response returned by the relayer.



<h3>See also:</h3>
<ul>
	
	<li><a href="../modules/slimta.message.response.html">
		slimta.message.response
	</a>
	
	<li><a href="../modules/slimta.storage.session.html">
		slimta.storage.session
	</a>
	
</ul>

</dd>


</dl>






</div> <!-- id="content" -->

</div> <!-- id="main" -->

<div id="about">
    <p><a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0!" height="31" width="88" /></a></p>
</div> <!-- id="about" -->

</div> <!-- id="container" -->
</body>
</html>
